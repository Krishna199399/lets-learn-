<!DOCTYPE html>
<html>

<head>
    <title>Auth Test</title>
</head>

<body>
    <h1>Authentication Token Test</h1>
    <button onclick="checkToken()">Check Token</button>
    <button onclick="testUpdate()">Test Course Update</button>
    <pre id="output"></pre>

    <script>
        function checkToken() {
            const token = localStorage.getItem('token');
            const user = localStorage.getItem('user');

            const output = document.getElementById('output');
            output.textContent = 'Token exists: ' + !!token + '\n';
            output.textContent += 'Token (first 50 chars): ' + (token ? token.substring(0, 50) + '...' : 'NULL') + '\n\n';
            output.textContent += 'User data:\n' + user + '\n';

            if (user) {
                try {
                    const userData = JSON.parse(user);
                    output.textContent += '\nUser role: ' + userData.role + '\n';
                } catch (e) {
                    output.textContent += '\nError parsing user data\n';
                }
            }
        }

        async function testUpdate() {
            const token = localStorage.getItem('token');
            const courseId = '{{COURSE_ID}}'; // Replace with actual course ID

            const output = document.getElementById('output');
            output.textContent = 'Testing course update...\n';

            try {
                const response = await fetch(`http://localhost:5000/api/courses/${courseId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`,
                    },
                    body: JSON.stringify({
                        demoVideoUrl: 'http://localhost:5000/videos/demo-countdown.mp4'
                    }),
                });

                output.textContent += 'Status: ' + response.status + '\n';

                if (response.ok) {
                    const data = await response.json();
                    output.textContent += 'Success!\n' + JSON.stringify(data, null, 2);
                } else {
                    const errorText = await response.text();
                    output.textContent += 'Error: ' + errorText;
                }
            } catch (error) {
                output.textContent += 'Exception: ' + error.message;
            }
        }
    </script>
</body>

</html>